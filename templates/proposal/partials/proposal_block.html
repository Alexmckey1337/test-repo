{% load i18n %}
{% load static %}

<div class="container">
    <div class="proposal">
        <div class="proposal__wrap">
            <div class="proposal__info">
                <h1>{% trans "Статус" %}:
                    {% if proposal.get_status_display == 'In progress' %}В работе
                    {% elif proposal.get_status_display == 'Reopen' %}Открыта повторно
                    {% elif proposal.get_status_display == 'Rejected' %}Отклонена
                    {% elif proposal.get_status_display == 'Processed' %}Выполнена
                    {% elif proposal.get_status_display == 'Open' %}Открыта
                    {% endif %}
                </h1>
                {% if proposal.is_open %}
                    {% include "proposal/partials/proposal_card.html" %}
                    <button id="proposalStatus" class="add"
                            data-type="receive"
                            data-id="{{ proposal.id }}">
                        {% trans "Взять в работу" %}
                    </button>
                    {#        {% include "proposal/partials/similar_users.html" %}#}
                {% elif proposal.in_progress %}
                    {% if request.user == proposal.manager %}
                        {% include "proposal/partials/proposal_card.html" %}
                        {% if request.user == proposal.manager %}
                            <button id="proposalStatus" class="reload"
                                    data-type="reopen"
                                    data-id="{{ proposal.id }}">
                                {% trans "Переоткрыть" %}
                            </button>
                            <button id="proposalReject" class="close close-popup"
                                    data-id="{{ proposal.id }}">
                                {% trans "Отклонить" %}
                            </button>
                        {% endif %}
                        </div>
                        <div class="proposal__similar">
                            {% include "proposal/partials/similar_users.html" %}
                        </div>
                    {% else %}
                        access error
                    {% endif %}
                {% elif proposal.is_complete %}
                    {{ proposal.note|default_if_none:" " }}
                    {% if request.user == proposal.manager %}
                        {% include "proposal/partials/proposal_card.html" %}
                        <button id="proposalStatus" class="reply"
                                data-type="receive"
                                data-id="{{ proposal.id }}">
                            {% trans "Вернуть в работу" %}
                        </button>
                    {% else %}
                        access error
                    {% endif %}
                {% else %}
                    incorrect status
                {% endif %}
    </div>
</div>
<div class="proposal__log">
        <table>
            <thead>
            <tr>
                <th>Дата</th>
                <th>Кто изменял</th>
                <th>Менеджер</th>
                <th>Пользователь</th>
                <th>Статус</th>
                <th>Нотатки</th>
                <th>Дата закрытия</th>
            </tr>
            </thead>
            <tbody>
                {% for log in proposal.histories.all %}
                    <tr>
                        <td>{{ log.created_at }}</td>
                        <td>{{ log.owner }}</td>
                        <td>{{ log.manager }}</td>
                        <td>{{ log.user }}</td>
                        <td>{{ log.status }}</td>
                        <td>{{ log.note }}</td>
                        <td>{{ log.closed_at }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</div>
