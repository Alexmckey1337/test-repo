{% extends "layout_main.html" %}
{% load static %}

{% block body_id %} id="database"{% endblock %}

{% block header.top.h1 %}<h1>Карточка Церкви</h1>{% endblock %}

{% block header.buttons %}
    <div class="top-panel">
        <div class="top-buttons-wrap">
            <ul class="top-buttons">
                <li class="dropdown">
                    <button class="add">Добавить</button>
                    <ul class="top-buttons-submenu">
                        <li><button id="addUserToChurch">Пользователя</button></li>
                        <li><button id="addHomeGroupToChurch">Домашнюю группу</button></li>
                    </ul>
                </li>
                <li>
                    <button id="export_table" data-export-url="{% url "church-export-users" pk=church.id %}"
                            class="download header__button">Export
                    </button>
                </li>
                <li>
                    <button id="sort-on"><i class="fa fa-cog" aria-hidden="true"></i></button>
                </li>
            </ul>
        </div>
    </div>
{% endblock %}

{% block header.buttons.export %}
{% endblock %}

{% block main.content %}
    <div class="content content_anketa accordion">
        <div class="left-contentwrap">
            <div class="left-content">
                <div class="user-fiowrap">
                    <div class="user-fio">
                        <div class="right-info-r">
                            <button class="edit" id="editNameBtn" data-edit-block="editNameBlock"></button>
                            <hgroup>
                                <h3 id="fullName">{{ church.get_title }}</h3>
                            </hgroup>
                        </div>
                        <div class="anketa-photo">
                            {% if church.image %}
                                <img src="{{ church.image.url }}" alt="photo">
                            {% else %}
                                <img src="{% static "img/no-church.png" %}" alt="photo">
                            {% endif %}
                        </div>
                    </div>
                </div>
                <ul class="right-info">
                    <li class="hidden" id="editNameBlock" data-edit="editNameBtn">
                        <div class="right-info__block">
                            <h4>Данные церкви</h4>
                            <div class="success__block"></div>
                            <form action="/" name="editName" data-action="update-user">
                                <button class="save__info after__hidden" type="submit"></button>
                                <div class="popup_body">
                                    <div class="container">
                                        <label>
                                            <span class="label_block">Имя</span>
                                            <input type="text" name="first_name" value="{{ account.first_name }}"
                                                   readonly>
                                        </label>
                                        <label>
                                            <span class="label_block">Фамилия</span>
                                            <input type="text" name="last_name" value="{{ account.last_name }}"
                                                   readonly>
                                        </label>
                                        <label>
                                            <span class="label_block">Отчество</span>
                                            <input type="text" name="middle_name" value="{{ account.middle_name }}"
                                                   readonly>
                                        </label>
                                        <label>
                                            <span class="label_block">Имя на родном языке</span>
                                            <input type="text" name="search_name" value="{{ account.search_name }}"
                                                   readonly>
                                        </label>
                                        <label>
                                            <span class="label_block">Фото</span>
                                            <input type="file" id="file">
                                        </label>
                                        <p>Размер файла не должен превышать 10 МБ.</p>
                                        <p>Типы файлов, которые поддерживаются: jpg, jpeg, png.</p>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </li>
                    <li id="editContact">
                        <div class="right-info__block">
                            <h4>Контактные данные</h4>
                            <div class="success__block"></div>
                            <form action="/" id="editContactForm" name="editContact" data-action="update-user">
                                <button class="edit" data-edit-block="editContact"></button>
                                <button class="save__info" type="submit"></button>
                                <div class="popup_body">
                                    <div class="container">
                                        <label id="phone_number-label">
                                            <span class="label_block">
                                                <i class="fa fa-phone" aria-hidden="true"></i>
                                            </span>
                                            <div class="label_phone_block">
                                                <input type="text" id="phone_number" name="phone_number"
                                                       value="{{ church.phone_number }}" readonly>
                                                <span class="comment"></span>
                                            </div>
                                        </label>
                                        <label>
                                            <span class="label_block"><i class="fa fa-envelope"></i></span>
                                            <input type="email" name="email" value="{{ church.address }}"
                                                   data-validation="email" data-validation-optional="true" readonly>
                                        </label>
                                        <label>
                                            <span class="label_block"><i class="fa fa-globe" aria-hidden="true"></i></span>
                                            <input type="text" name="skype" value="{{ church.website }}" readonly>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </li>
                    <li id="editOpen">
                        <div class="right-info__block">
                            <h4>Контактные данные</h4>
                            <div class="success__block"></div>
                            <form action="/" id="editOpenForm" name="editOpen" data-action="update-user">
                                <button class="edit" data-edit-block="editOpen"></button>
                                <button class="save__info" type="submit"></button>
                                <div class="popup_body">
                                    <div class="container">
                                        <label>
                                            <span class="label_block">Открыта</span>
                                                <input type="checkbox" id="is_open_church" {% if church.is_open %}checked{% endif %}
                                                       readonly disabled="disabled">
                                                <div></div>
                                        </label>
                                        <label>
                                            <span class="label_block">Дата открытия</span>
                                            <div class="input">
                                                <input type="text" class="date" id="opening_date" value="{{ church.opening_date }}"
                                                       disabled="disabled" readonly>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </li>
                    <li id="editDepartment">
                        <div class="right-info__block">
                            <h4>Контактные данные</h4>
                            <div class="success__block"></div>
                            <form action="/" id="editDepartmentForm" name="editDepartment" data-action="update-user">
                                <button class="edit" data-edit-block="editDepartment"></button>
                                <button class="save__info" type="submit"></button>
                                <div class="popup_body">
                                    <div class="container">
                                        <label>
                                            <span class="label_block">Отдел:</span>
                                            <select name="" id="editDepartmentSelect" readonly="readonly" disabled="disabled">
                                                <option value="{{ church.department.id }}">{{ church.department }}</option>
                                            </select>
                                        </label>
                                        <label>
                                            <span class="label_block">Пастор:</span>
                                            <div class="input">
                                                <select name="" id="editPastorSelect" readonly="readonly" disabled="disabled">
                                                    <option value="{{ church.pastor.id }}">{{ church.pastor }}</option>
                                                </select>
                                                <a href="{{ church.pastor.get_absolute_url }}" target="_blank">
                                                    <i class="fa fa-external-link" aria-hidden="true"></i>
                                                </a>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </li>
                    <li id="editAddress">
                        <div class="right-info__block">
                            <h4>Контактные данные</h4>
                            <div class="success__block"></div>
                            <form action="/" id="editAddressForm" name="editAddress" data-action="update-user">
                                <button class="edit" data-edit-block="editAddress"></button>
                                <button class="save__info" type="submit"></button>
                                <div class="popup_body">
                                    <div class="container">
                                        <label>
                                            <span class="label_block">Страна:</span>
                                            <input type="text" id="country" value="{{ church.country }}" readonly>
                                        </label>
                                        <label>
                                            <span class="label_block">Город:</span>
                                            <input type="text" id="city" value="{{ church.city }}" readonly>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </li>
                    <li id="editCurrency">
                        <div class="right-info__block">
                            <h4>Валюта</h4>
                            <div class="success__block"></div>
                            <form action="/" id="editCurrencyForm" name="editCurrency" data-action="update-user">
                                <button class="edit" data-edit-block="editCurrency"></button>
                                <button class="save__info" type="submit"></button>
                                <div class="popup_body">
                                    <div class="container">
                                        <label>
                                            <span class="label_block">Валюта:</span>
                                            <div class="input">
                                                <select id="report_currency" readonly="readonly" disabled="disabled">
                                                    {% for currency in currencies %}
                                                        <option value="{{ currency.id }}"
                                                                {% if currency.id == church.report_currency %}selected{% endif %}>{{ currency.short_name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </li>
                </ul>
            </div>
{#            <h2 class="info-title">Основная информация:</h2>#}
{#            <div class="info">#}
{#                <form action="/" id="editChurchForm" name="editChurch" data-id="{{ church.id }}">#}
{#                    <button class="edit"></button>#}
{#                    <button class="save__info" type="submit"></button>#}
{#                    <div class="success__block"></div>#}
{#                    <div class="popup_body">#}
{#                        <div class="container container_block">#}
{#                            <label>#}
{#                                <span class="label_block">Открыта</span>#}
{#                                <div class="input">#}
{#                                    <input type="checkbox" id="is_open_church" {% if church.is_open %}checked{% endif %}#}
{#                                           readonly disabled="disabled">#}
{#                                    <div></div>#}
{#                                </div>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Дата открытия</span>#}
{#                                <div class="input">#}
{#                                    <input type="text" class="date" id="opening_date" value="{{ church.opening_date }}"#}
{#                                           disabled="disabled" readonly>#}
{#                                </div>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Отдел:</span>#}
{#                                <select name="" id="editDepartmentSelect" readonly="readonly" disabled="disabled">#}
{#                                    <option value="{{ church.department.id }}">{{ church.department }}</option>#}
{#                                </select>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Пастор:</span>#}
{#                                <div class="input">#}
{#                                    <select name="" id="editPastorSelect" readonly="readonly" disabled="disabled">#}
{#                                        <option value="{{ church.pastor.id }}">{{ church.pastor }}</option>#}
{#                                    </select>#}
{#                                    <a href="{{ church.pastor.get_absolute_url }}" target="_blank">#}
{#                                        <i class="fa fa-external-link" aria-hidden="true"></i>#}
{#                                    </a>#}
{#                                </div>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Страна:</span>#}
{#                                <input type="text" id="country" value="{{ church.country }}" readonly>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Город:</span>#}
{#                                <input type="text" id="city" value="{{ church.city }}" readonly>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Адрес:</span>#}
{#                                <input type="text" id="address" value="{{ church.address }}" readonly>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Телефон:</span>#}
{#                                <input type="text" id="phone_number" value="{{ church.phone_number }}" readonly>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Сайт:</span>#}
{#                                <div class="input">#}
{#                                    <input type="text" id="web_site" value="{{ church.website }}" readonly>#}
{#                                    <a href="{{ church.website }}" target="_blank" id="site-link"#}
{#                                       {% if not church.website %}class="link-hide"{% endif %}>#}
{#                                        <i class="fa fa-external-link" aria-hidden="true"></i>#}
{#                                    </a>#}
{#                                </div>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Валюта:</span>#}
{#                                <div class="input">#}
{#                                    <select id="report_currency" readonly="readonly" disabled="disabled">#}
{#                                        {% for currency in currencies %}#}
{#                                            <option value="{{ currency.id }}"#}
{#                                                    {% if currency.id == church.report_currency %}selected{% endif %}>{{ currency.short_name }}</option>#}
{#                                        {% endfor %}#}
{#                                    </select>#}
{#                                </div>#}
{#                            </label>#}
{#                        </div>#}
{#                    </div>#}
{#                </form>#}
{#            </div>#}
        </div>
        <div class="right-contentwrap">
            <div class="right-content">
                <div class="a-block a-church">
                    <div class="top-s">
                        <h3>Сводная информация</h3>
                    </div>
                    <div class="info info-calc">
                        <div class="popup_body">
                            <div class="container container_block">
                                <label>
                                    <span class="label_block">Прихожан:</span>
                                    <p class="count"><span id="parishioners_count">{{ parishioners_count }}</span></p>
                                </label>
                                <label>
                                    <span class="label_block">Лидеров:</span>
                                    <p class="count"><span id="leaders_count">{{ leaders_count }}</span></p>
                                </label>
                                <label>
                                    <span class="label_block">Отцов:</span>
                                    <p class="count"><span id="fathers_count">{{ fathers_count }}</span></p>
                                </label>
                                <label>
                                    <span class="label_block">Юношей:</span>
                                    <p class="count"><span id="juniors_count">{{ juniors_count }}</span></p>
                                </label>
                                <label>
                                    <span class="label_block">Младенцев:</span>
                                    <p class="count"><span id="babies_count">{{ babies_count }}</span></p>
                                </label>
                            </div>
                            <div class="container container_block">
                                <label>
                                    <span class="label_block">Партнеров:</span>
                                    <p class="count"><span id="partners_count">{{ partners_count }}</span></p>
                                </label>
                                <label>
                                    <span class="label_block">Не партнеров:</span>
                                    <p class="count"><span id="no_partners_count">{{ no_partners_count }}</span></p>
                                    <a href="{% url 'db:people' %}" target="_blank" id="no_partners-link">
                                        <i class="fa fa-external-link" aria-hidden="true"></i>
                                    </a>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                {% for partner in church.partners.all %}
                    <div id="editPartnershipNeed">
                        <div class="a-block a-church" id="editPartnership">
                        <div class="top-s">
                            <h3>Партнерские данные</h3>
                        </div>
                        <div class="success__block"></div>
                        {% include "account/partials/partner_form.html" with bla=church partner=partner is_supervisor=request.user.is_partner_supervisor_or_high %}
                    </div>
                        <div class="a-block a-church">
                        <div class="top-s">
                            <h3>Молитвенная нужда</h3>
                        </div>
                        <form class="partnership_need" action="/" name="editPartnershipNeed" data-action="update-user"
                              data-partner="{{ partner.id }}"
                              id="partnership_need">
                            <input type="hidden" data-id="user" value="{{ partner.id }}">
                            <button class="edit" data-edit-block="editPartnershipNeed"></button>
                            <button class="save__info" type="submit"></button>
                            <textarea data-id="need_text" id="id_need_text" rows="7" cols="50"
                                      readonly>{{ partner.need_text }}</textarea>
                        </form>
                    </div>
                    </div>
{#                    <div class="a-sdelki a-church_sdelki" id="editPartnershipNeed">#}
{#                        <div class="partner_wrapper">#}
{#                            <ul class="right-info">#}
{#                                <li id="editPartnership">#}
{#                                    <div class="right-info__block">#}
{#                                        <h4>Партнерские данные</h4>#}
{#                                        <div class="success__block"></div>#}
{#                                        {% include "account/partials/partner_form.html" with bla=church partner=partner is_supervisor=request.user.is_partner_supervisor_or_high %}#}
{#                                    </div>#}
{#                                </li>#}
{#                            </ul>#}
{#                            <div  class="note_wrapper">#}
{#                                <form class="partnership_need" action="/" name="editPartnershipNeed" data-action="update-user"#}
{#                                      data-partner="{{ partner.id }}"#}
{#                                      id="partnership_need">#}
{#                                    <input type="hidden" data-id="user" value="{{ partner.id }}">#}
{#                                    <button class="edit" data-edit-block="editPartnershipNeed"></button>#}
{#                                    <button class="save__info" type="submit"></button>#}
{#                                    <label for="id_need_text">Молитвенная нужда</label>#}
{#                                    <textarea data-id="need_text" id="id_need_text" rows="7" cols="50"#}
{#                                              readonly>{{ partner.need_text }}</textarea>#}
{#                                </form>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
                    {% empty %}
                    <div class="a-block a-church" id="editPartnership">
                        <div class="top-s">
                            <h3>Партнерские данные</h3>
                        </div>
                        <div class="success__block"></div>
                                        {% include "account/partials/partner_form.html" with bla=church partner=partner is_supervisor=request.user.is_partner_supervisor_or_high %}
                    </div>
                    <div class="a-block a-church a-church_sdelki" id="editPartnershipNeed">
                        <div class="top-s">
                            <h3>Молитвенная нужда</h3>
                        </div>
                        <form class="partnership_need" action="/" name="editPartnershipNeed" data-action="update-user"
                              data-partner="{{ partner.id }}"
                              id="partnership_need">
                            <input type="hidden" data-id="user" value="{{ partner.id }}">
                            <button class="edit" data-edit-block="editPartnershipNeed"></button>
                            <button class="save__info" type="submit"></button>
                            <textarea data-id="need_text" id="id_need_text" rows="7" cols="50"
                                      readonly>{{ partner.need_text }}</textarea>
                        </form>
                    </div>
{#                    <div class="a-sdelki a-church_sdelki">#}
{#                        <div class="partner_wrapper">#}
{#                            <ul class="right-info">#}
{#                                <li id="editPartnership">#}
{#                                    <div class="right-info__block">#}
{#                                        <h4>Партнерские данные</h4>#}
{#                                        <div class="success__block"></div>#}
{#                                        {% include "account/partials/partner_form.html" with bla=church partner=partner is_supervisor=request.user.is_partner_supervisor_or_high %}#}
{#                                    </div>#}
{#                                </li>#}
{#                            </ul>#}
{#                            <div id="editPartnershipNeed" class="note_wrapper">#}
{#                                <form class="partnership_need" action="/" name="editPartnershipNeed" data-action="update-user"#}
{#                                      data-partner="{{ partner.id }}"#}
{#                                      id="partnership_need">#}
{#                                    <input type="hidden" data-id="user" value="{{ partner.id }}">#}
{#                                    <button class="edit" data-edit-block="editPartnershipNeed"></button>#}
{#                                    <button class="save__info" type="submit"></button>#}
{#                                    <label for="id_need_text">Молитвенная нужда</label>#}
{#                                    <textarea data-id="need_text" id="id_need_text" rows="7" cols="50"#}
{#                                              readonly>{{ partner.need_text }}</textarea>#}
{#                                </form>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="accordion">
        {#        <h2 class="info-title">Основная информация:</h2>#}
        {#        <div class="info">#}
        {#            <form action="/" id="editChurchForm" name="editChurch" data-id="{{ church.id }}">#}
        {#                <button class="edit"></button>#}
        {#                <button class="save__info" type="submit"></button>#}
        {#                <div class="success__block"></div>#}
        {#                <div class="popup_body">#}
        {#                    <div class="container container_block">#}
        {#                        <label>#}
        {#                            <span class="label_block">Открыта</span>#}
        {#                            <div class="input">#}
        {#                                <input type="checkbox" id="is_open_church" {% if church.is_open %}checked{% endif %}#}
        {#                                       readonly disabled="disabled">#}
        {#                                <div></div>#}
        {#                            </div>#}
        {#                        </label>#}
        {#                        <label>#}
        {#                            <span class="label_block">Дата открытия</span>#}
        {#                            <div class="input">#}
        {#                                <input type="text" class="date" id="opening_date" value="{{ church.opening_date }}"#}
        {#                                       disabled="disabled" readonly>#}
        {#                            </div>#}
        {#                        </label>#}
        {#                        <label>#}
        {#                            <span class="label_block">Отдел:</span>#}
        {#                            <select name="" id="editDepartmentSelect" readonly="readonly" disabled="disabled">#}
        {#                                <option value="{{ church.department.id }}">{{ church.department }}</option>#}
        {#                            </select>#}
        {#                        </label>#}
        {#                        <label>#}
        {#                            <span class="label_block">Пастор:</span>#}
        {#                            <div class="input">#}
        {#                                <select name="" id="editPastorSelect" readonly="readonly" disabled="disabled">#}
        {#                                    <option value="{{ church.pastor.id }}">{{ church.pastor }}</option>#}
        {#                                </select>#}
        {#                                <a href="{{ church.pastor.get_absolute_url }}" target="_blank">#}
        {#                                    <i class="fa fa-external-link" aria-hidden="true"></i>#}
        {#                                </a>#}
        {#                            </div>#}
        {#                        </label>#}
        {#                        <label>#}
        {#                            <span class="label_block">Страна:</span>#}
        {#                            <input type="text" id="country" value="{{ church.country }}" readonly>#}
        {#                        </label>#}
        {#                        <label>#}
        {#                            <span class="label_block">Город:</span>#}
        {#                            <input type="text" id="city" value="{{ church.city }}" readonly>#}
        {#                        </label>#}
        {#                        <label>#}
        {#                            <span class="label_block">Адрес:</span>#}
        {#                            <input type="text" id="address" value="{{ church.address }}" readonly>#}
        {#                        </label>#}
        {#                        <label>#}
        {#                            <span class="label_block">Телефон:</span>#}
        {#                            <input type="text" id="phone_number" value="{{ church.phone_number }}" readonly>#}
        {#                        </label>#}
        {#                        <label>#}
        {#                            <span class="label_block">Сайт:</span>#}
        {#                            <div class="input">#}
        {#                                <input type="text" id="web_site" value="{{ church.website }}" readonly>#}
        {#                                <a href="{{ church.website }}" target="_blank" id="site-link"#}
        {#                                   {% if not church.website %}class="link-hide"{% endif %}>#}
        {#                                    <i class="fa fa-external-link" aria-hidden="true"></i>#}
        {#                                </a>#}
        {#                            </div>#}
        {#                        </label>#}
        {#                        <label>#}
        {#                            <span class="label_block">Валюта:</span>#}
        {#                            <div class="input">#}
        {#                                <select id="report_currency" readonly="readonly" disabled="disabled">#}
        {#                                    {% for currency in currencies %}#}
        {#                                        <option value="{{ currency.id }}"#}
        {#                                                {% if currency.id == church.report_currency %}selected{% endif %}>{{ currency.short_name }}</option>#}
        {#                                    {% endfor %}#}
        {#                                </select>#}
        {#                            </div>#}
        {#                        </label>#}
        {#                    </div>#}
        {#                </div>#}
        {#            </form>#}
        {#        </div>#}
        {#        <h2 class="info-title">Сводная информация:</h2>#}
        {#        <div class="info info-calc">#}
        {#            <div class="popup_body">#}
        {#                        <div class="container container_block">#}
        {#                            <label>#}
        {#                                <span class="label_block">Прихожан:</span>#}
        {#                                <p class="count"><span id="parishioners_count">{{ parishioners_count }}</span></p>#}
        {#                            </label>#}
        {#                            <label>#}
        {#                                <span class="label_block">Лидеров:</span>#}
        {#                                <p class="count"><span id="leaders_count">{{ leaders_count }}</span></p>#}
        {#                            </label>#}
        {#                            <label>#}
        {#                                <span class="label_block">Отцов:</span>#}
        {#                                <p class="count"><span id="fathers_count">{{ fathers_count }}</span></p>#}
        {#                            </label>#}
        {#                            <label>#}
        {#                                <span class="label_block">Юношей:</span>#}
        {#                                <p class="count"><span id="juniors_count">{{ juniors_count }}</span></p>#}
        {#                            </label>#}
        {#                            <label>#}
        {#                                <span class="label_block">Младенцев:</span>#}
        {#                                <p class="count"><span id="babies_count">{{ babies_count }}</span></p>#}
        {#                            </label>#}
        {#                            <label>#}
        {#                                <span class="label_block">Партнеров:</span>#}
        {#                                <p class="count"><span id="partners_count">{{ partners_count }}</span></p>#}
        {#                            </label>#}
        {#                            <label>#}
        {#                                <span class="label_block">Не партнеров:</span>#}
        {#                                <p class="count"><span id="no_partners_count">{{ no_partners_count }}</span></p>#}
        {#                                <a href="{% url 'db:people' %}" target="_blank" id="no_partners-link">#}
        {#                                    <i class="fa fa-external-link" aria-hidden="true"></i>#}
        {#                                </a>#}
        {#                            </label>#}
        {#                        </div>#}
        {#                    </div>#}
        {#        </div>#}
    </div>
    <div class="container">
        <div class="col-12">
            <div class="top-panel tabs-panel">
                <div class="tabs">
                    <ul class="tabs_link">
                        <li class="mb get_info">
                            <button data-link="home_groups"
                                    data-export-url="{% url "church-export-groups" pk=church.id %}"
                                    data-editable="false">Количество Домашних групп: <span
                                    id="home_groups_count">{{ home_groups_count }}</span></button>
                        </li>
                        <li class="get_info">
                            <button data-link="all_users"
                                    data-export-url="{% url "church-export-all-users" pk=church.id %}"
                                    data-editable="false">Общее количество людей: <span
                                    id="church_all_users">{{ church_all_users }}</span></button>
                        </li>
                        <li class="mb get_info">
                            <button class="active" data-export-url="{% url "church-export-users" pk=church.id %}"
                                    data-link="users" data-editable="true">Люди не в домашних группах: <span
                                    id="church_users">{{ church_users }}</span></button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
{#    <h1>{{ church.get_title }}</h1>#}
{#    <div class="accordion">#}
{#        <h2 class="info-title">Основная информация:</h2>#}
{#        <div class="info">#}
{#            <form action="/" id="editChurchForm" name="editChurch" data-id="{{ church.id }}">#}
{#                <button class="edit"></button>#}
{#                <button class="save__info" type="submit"></button>#}
{#                <div class="success__block"></div>#}
{#                    <div class="popup_body">#}
{#                        <div class="container container_block">#}
{#                            <label>#}
{#                                <span class="label_block">Открыта</span>#}
{#                                <div class="input">#}
{#                                    <input type="checkbox" id="is_open_church" {% if church.is_open %}checked{% endif %}#}
{#                                           readonly disabled="disabled">#}
{#                                    <div></div>#}
{#                                </div>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Дата открытия</span>#}
{#                                <div class="input">#}
{#                                    <input type="text" class="date" id="opening_date" value="{{ church.opening_date }}"#}
{#                                           disabled="disabled" readonly>#}
{#                                </div>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Отдел:</span>#}
{#                                <select name="" id="editDepartmentSelect" readonly="readonly" disabled="disabled">#}
{#                                    <option value="{{ church.department.id }}">{{ church.department }}</option>#}
{#                                </select>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Пастор:</span>#}
{#                                <div class="input">#}
{#                                    <select name="" id="editPastorSelect" readonly="readonly" disabled="disabled">#}
{#                                        <option value="{{ church.pastor.id }}">{{ church.pastor }}</option>#}
{#                                    </select>#}
{#                                    <a href="{{ church.pastor.get_absolute_url }}" target="_blank">#}
{#                                        <i class="fa fa-external-link" aria-hidden="true"></i>#}
{#                                    </a>#}
{#                                </div>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Страна:</span>#}
{#                                <input type="text" id="country" value="{{ church.country }}" readonly>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Город:</span>#}
{#                                <input type="text" id="city" value="{{ church.city }}" readonly>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Адрес:</span>#}
{#                                <input type="text" id="address" value="{{ church.address }}" readonly>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Телефон:</span>#}
{#                                <input type="text" id="phone_number" value="{{ church.phone_number }}" readonly>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Сайт:</span>#}
{#                                <div class="input">#}
{#                                    <input type="text" id="web_site" value="{{ church.website }}" readonly>#}
{#                                    <a href="{{ church.website }}" target="_blank" id="site-link"#}
{#                                       {% if not church.website %}class="link-hide"{% endif %}>#}
{#                                        <i class="fa fa-external-link" aria-hidden="true"></i>#}
{#                                    </a>#}
{#                                </div>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Валюта:</span>#}
{#                                <div class="input">#}
{#                                    <select id="report_currency" readonly="readonly" disabled="disabled">#}
{#                                        {% for currency in currencies %}#}
{#                                            <option value="{{ currency.id }}"#}
{#                                                    {% if currency.id == church.report_currency %}selected{% endif %}>{{ currency.short_name }}</option>#}
{#                                        {% endfor %}#}
{#                                    </select>#}
{#                                </div>#}
{#                            </label>#}
{#                        </div>#}
{#                    </div>#}
{#        </div>#}
{#        </form>#}
{#        <h2 class="info-title">Сводная информация:</h2>#}
{#        <div class="info info-calc">#}
{#            <div class="popup_body">#}
{#                        <div class="container container_block">#}
{#                            <label>#}
{#                                <span class="label_block">Прихожан:</span>#}
{#                                <p class="count"><span id="parishioners_count">{{ parishioners_count }}</span></p>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Лидеров:</span>#}
{#                                <p class="count"><span id="leaders_count">{{ leaders_count }}</span></p>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Отцов:</span>#}
{#                                <p class="count"><span id="fathers_count">{{ fathers_count }}</span></p>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Юношей:</span>#}
{#                                <p class="count"><span id="juniors_count">{{ juniors_count }}</span></p>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Младенцев:</span>#}
{#                                <p class="count"><span id="babies_count">{{ babies_count }}</span></p>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Партнеров:</span>#}
{#                                <p class="count"><span id="partners_count">{{ partners_count }}</span></p>#}
{#                            </label>#}
{#                            <label>#}
{#                                <span class="label_block">Не партнеров:</span>#}
{#                                <p class="count"><span id="no_partners_count">{{ no_partners_count }}</span></p>#}
{#                                <a href="{% url 'db:people' %}" target="_blank" id="no_partners-link">#}
{#                                    <i class="fa fa-external-link" aria-hidden="true"></i>#}
{#                                </a>#}
{#                            </label>#}
{#                        </div>#}
{#                    </div>#}
{#        </div>#}
{#    </div>#}
{#    <div class="container">#}
{#        <div class="col-12">#}
{#            <div class="top-panel tabs-panel">#}
{#                <div class="tabs">#}
{#                    <ul class="tabs_link">#}
{#                        <li class="mb get_info">#}
{#                            <button data-link="home_groups"#}
{#                                    data-export-url="{% url "church-export-groups" pk=church.id %}"#}
{#                                    data-editable="false">Количество Домашних групп: <span#}
{#                                    id="home_groups_count">{{ home_groups_count }}</span></button>#}
{#                        </li>#}
{#                        <li class="get_info">#}
{#                            <button data-link="all_users"#}
{#                                    data-export-url="{% url "church-export-all-users" pk=church.id %}"#}
{#                                    data-editable="false">Общее количество людей: <span#}
{#                                    id="church_all_users">{{ church_all_users }}</span></button>#}
{#                        </li>#}
{#                        <li class="mb get_info">#}
{#                            <button class="active" data-export-url="{% url "church-export-users" pk=church.id %}"#}
{#                                    data-link="users" data-editable="true">Люди не в домашних группах: <span#}
{#                                    id="church_users">{{ church_users }}</span></button>#}
{#                        </li>#}
{#                    </ul>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
    {% block pagination_top %}
        <div class="top-pag">
            <div class="table__count"></div>
            <div class="pagination users__pagination"><!--pagination -->
            </div><!--End pagination -->
        </div>
    {% endblock %}

    {% block table %}
        <div class="table-wrap clearfix can_edit" id="church" data-id="{{ church.id }}"
             data-department_id="{{ church.department.id }}" data-department_title="{{ church.department }}">
            <!--Table -->
            <div class="table scrollbar-inner" id="tableUserINChurches"></div>
            <div class="query-none">
                <p></p>
            </div>
        </div><!--End Table -->

    {% endblock %}

    {% block pagination_bottom %}
        <div class="table__count"></div>
        <div class="pagination users__pagination"></div>
    {% endblock %}
{% endblock %}

{% block create_user %}
    {% include 'partials/create_user.html' %}
{% endblock %}

{% block popup %}
    <div class="popap popap_slide" id='addHomeGroup'>
        <div class="pop_cont">
            <div class="popup_text">
                <h2>Добавление домашней группы</h2>
                <span class="close close-popup"><i class="fa fa-times" aria-hidden="true"></i></span>
            </div>
            <form action="" id="addHomeGroupForm">
                <div class="popup_body">
                    <div class="container container_block">
                        <label>
                            <span class="label_block">Дата открытия</span>
                            <input id="added_home_group_date" required>
                        </label>
                        <label>
                            <span class="label_block">Название</span>
                            <input type="text" id="added_home_group_title">
                        </label>
                        <label>
                            <span class="label_block">Церковь</span>
                            <p id="added_home_group_church" data-id="{{ church.id }}"
                               data-department="{{ church.department.id }}">{{ church.get_title }}</p>
                        </label>
                        <label>
                            <span class="label_block">Лидер</span>
                            <select id="added_home_group_pastor" required>
                                <option>Выберите пастора</option>
                            </select>
                        </label>
                        <label>
                            <span class="label_block">Город</span>
                            <input type="text" id="added_home_group_city" required>
                        </label>
                        <label>
                            <span class="label_block">Адрес служения</span>
                            <input type="text" id="added_home_group_address">
                        </label>
                        <label>
                            <span class="label_block">Телефон</span>
                            <input type="tel" id="added_home_group_phone">
                        </label>
                        <label>
                            <span class="label_block">Сайт</span>
                            <input type="url" id="added_home_group_site">
                        </label>
                    </div>
                </div>
                <div class="container">
                    <button class="close-popup">Отменить</button>
                    <button type="submit" class="add-church">Создать</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script src="{% static "js/churches_detail.bundle.js" %}"></script>
    <script src="{% static "js/add_user.bundle.js" %}"></script>
{% endblock %}

{% block template_tables %}
<script type="text/template" id="databaseUsers">
     <table id="table-1">
        <thead>
        <tr>
            <% for( var key in user_table) { %>
                <% if(user_table[key].active) { %>
                    <th data-order="<%=user_table[key].ordering_title%>"><%=user_table[key].title %></th>
                <% } %>
            <% } %>
        </tr>
        </thead>
        <tbody>
            <% for( var index in results) { %>
            <tr>
                <% for( var key in user_table) { %>
                    <% if(user_table[key].active) { %>
                        <% if (key == 'fullname') { %>
                            <% if (results[index][key] != null) { %>
                                <td class="edit">
                                    <button class="delete_btn"></button>
                                    <a href="<%= results[index].link %>"
                                                    data-link="<%= results[index].link %>"
                                                    data-id="<%=results[index].id %>"
                                                    <% if(results[index].ankets_id) { %>
                                                        data-ankets="<%= results[index].ankets_id %>"
                                                    <% } %>><%= results[index][key] %></a>
                                    </td>
                            <% } else { %>
                                <td></td>
                            <% } %>
                        <% } else if(key == 'get_title') { %>
                            <% if (results[index][key] != null) { %>
                                <td class="edit"><a href="<%= results[index].link %>" data-link="<%= results[index].link %>" data-id="<%=results[index].id %>"><%= results[index][key] %></a><span class="quick-edit"></span></td>
                            <% } else { %>
                                <td></td>
                            <% } %>
                        <% } else if (key == 'master' || key == 'pastor' || key == 'leader') { %>
                            <% if (results[index][key] != null) { %>
                                <td><%= results[index][key].fullname %></td>
                            <% } else { %>
                                <td></td>
                            <% } %>
                        <% }  else if (key == 'hierarchy' || key == 'church' ) { %>
                            <% if (results[index][key] != null ) { %>
                                <td><%= results[index][key].title %></td>
                            <% } else { %>
                                <td></td>
                            <% } %>
                        <% }  else if (key == 'department') { %>
                                <% if (results[index][key] != null ) { %>
                                <td><%= results[index][key].title %></td>
                                <% } else { %>
                                <td></td>
                                <% } %>
                            <% }else if (key == 'departments' || key == 'divisions') { %>
                            <% if ( Array.isArray(results[index][key]) && results[index][key].length != 0) { %>
                                <% if (results[index][key].length == 1) { %>
                                    <td><%= results[index][key][0].title %></td>
                                <% }  else { %>
                                    <td><%= results[index][key].reduce(function(sum, item, i) {
                                            return i < results[index][key].length - 1 ? sum + item.title + ', ' : sum + item.title
                                        }, "") %></td>
                                <% } %>
                            <% } else { %>
                                <td></td>
                            <% } %>
                        <% }  else { %>
                            <td><% if (results[index][key] === true ) { %>
                                <p class="text__center">✔</p>
                                <% } else if (results[index][key] === false){ %>

                                <% } else { %>
                                <%= results[index][key] %>
                                <% } %>
                            </td>
                        <% } %>
                    <% } %>
                <% } %>
            </tr>
            <% } %>
        </tbody>
    </table>
    <table id="header-fixed"></table>
</script>
{% endblock %}
