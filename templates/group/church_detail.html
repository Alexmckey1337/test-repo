{% extends "layout_main.html" %}
{% load static %}

{% block body_id %} id="database"{% endblock %}

{% block header.top.h1 %}<h1>Карточка Церкви</h1>{% endblock %}

{% block header.buttons %}
    <div class="top-panel">
        <div class="top-buttons-wrap">
            <ul class="top-buttons">
                <li>
                    <button class="add">Добавить</button>
                    <ul class="top-buttons-submenu">
                        <li>
                            <button id="add_userToChurch">Пользователя</button>
                        </li>
                        <li>
                            <button id="add_homeGroupToChurch">Домашнюю группу</button>
                        </li>
                    </ul>
                </li>
                <li>
                    <button id="export_table" data-export-url="{% url "church-export-users" pk=church.id %}"
                            class="download header__button">Export
                    </button>
                </li>
                <li>
                    <button id="sort-on"><i class="fa fa-cog" aria-hidden="true"></i></button>
                </li>
            </ul>
        </div>
    </div>
{% endblock %}

{% block header.buttons.export %}
{% endblock %}

{% block main.content %}
    <h1>{{ church.get_title }}</h1>
    <div class="accordion">
        <h2 class="info-title">Основная информация:</h2>
        <div class="info">
            <form action="/" id="editChurchForm" name="editChurch" data-id="{{ church.id }}">
                <button class="edit"></button>
                <button class="save__info" type="submit"></button>
                <div class="success__block"></div>
                <div class="info-block info-block_edit">
                    <div class="title-wrapper">
                        <span>Дата открытия:</span>
                    </div>
                    <div class="input">
                        <input type="text" class="date" id="opening_date" value="{{ church.opening_date }}"
                               disabled="disabled" readonly>
                        <input type="checkbox" id="is_open_church" {% if church.is_open %}checked{% endif %} readonly
                               disabled="disabled">
                    </div>
                    <div class="title-wrapper">
                        <span>Отдел:</span>
                    </div>
                    <div class="input">
                        <select name="" id="editDepartmentSelect" readonly="readonly" disabled="disabled">
                            <option value="{{ church.department.id }}">{{ church.department }}</option>
                        </select>
                    </div>
                    <div class="title-wrapper">
                        <span>Пастор:</span>
                    </div>
                    <div class="input">
                        <select name="" id="editPastorSelect" readonly="readonly" disabled="disabled">
                            <option value="{{ church.pastor.id }}">{{ church.pastor }}</option>
                        </select>
                        <a href="{{ church.pastor.get_absolute_url }}">
                            <i class="fa fa-link" aria-hidden="true"></i>
                        </a>
                    </div>
                    <div class="title-wrapper">
                        <span>Страна:</span>
                    </div>
                    <input type="text" id="country" value="{{ church.country }}" readonly>
                    <div class="title-wrapper">
                        <span>Город:</span>
                    </div>
                    <input type="text" id="city" value="{{ church.city }}" readonly>
                    <div class="title-wrapper">
                        <span>Адрес:</span>
                    </div>
                    <input type="text" id="address" value="{{ church.address }}" readonly>
                    <div class="title-wrapper">
                        <span>Телефон:</span>
                    </div>
                    <input type="text" id="phone_number" value="{{ church.phone_number }}" readonly>
                    <div class="title-wrapper">
                        <span>Сайт:</span>
                    </div>
                    <div class="input">
                        <input type="text" id="web_site" value="{{ church.website }}" readonly>
                        <a href="{{ church.website }}" target="_blank"
                           {% if not church.website %}class="link-hide"{% endif %}
                        >
                            <i class="fa fa-link" aria-hidden="true"></i>
                        </a>
                    </div>
                </div>
        </div>
        </form>
        <h2 class="info-title">Сводная информация:</h2>
        <div class="info info-calc">
            <div class="info-block">
                <div class="title-wrapper">
                    <span>Количество прихожан:</span>
                </div>
                <p><span id="parishioners_count">{{ parishioners_count }}</span></p>
                <div class="title-wrapper">
                    <span>Количество Лидеров:</span>
                </div>
                <p><span id="leaders_count">{{ leaders_count }}</span></p>
                <div class="title-wrapper">
                    <span>Количество Отцов:</span>
                </div>
                <p><span id="fathers_count">{{ fathers_count }}</span></p>
                <div class="title-wrapper">
                    <span>Количество Юношей:</span>
                </div>
                <p><span id="juniors_count">{{ juniors_count }}</span></p>
                <div class="title-wrapper">
                    <span>Количество Младенцев:</span>
                </div>
                <p><span id="babies_count">{{ babies_count }}</span></p>
                <div class="title-wrapper">
                    <span>Количество Партнеров:</span>
                </div>
                <p><span id="partners_count">{{ partners_count }}</span></p>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="col-12">
            <div class="top-panel tabs-panel">
                <div class="tabs">
                    <ul class="tabs_link">
                        <li class="mb get_info">
                            <button data-link="home_groups"
                                    data-export-url="{% url "church-export-groups" pk=church.id %}"
                                    data-editable="false">Количество Домашних групп: <span
                                    id="home_groups_count">{{ home_groups_count }}</span></button>
                        </li>
                        <li class="get_info">
                            <button data-link="all_users"
                                    data-export-url="{% url "church-export-all-users" pk=church.id %}"
                                    data-editable="false">Общее количество людей: <span
                                    id="church_all_users">{{ church_all_users }}</span></button>
                        </li>
                        <li class="mb get_info">
                            <button class="active" data-export-url="{% url "church-export-users" pk=church.id %}"
                                    data-link="users" data-editable="true">Люди не в домашних группах: <span
                                    id="church_users">{{ church_users }}</span></button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    {% block pagination_top %}
        <div class="top-pag">
            <div class="table__count"></div>
            <div class="pagination users__pagination"><!--pagination -->
            </div><!--End pagination -->
        </div>
    {% endblock %}

    {% block table %}
        <div class="table-wrap clearfix can_edit" id="church" data-id="{{ church.id }}"
             data-department_id="{{ church.department.id }}" data-department_title="{{ church.department }}">
            <!--Table -->
            <div class="table scrollbar-inner" id="tableUserINChurches"></div>
            <div class="query-none">
                <p></p>
            </div>
        </div><!--End Table -->

    {% endblock %}

    {% block pagination_bottom %}
        <div class="table__count"></div>
        <div class="pagination users__pagination"></div>
    {% endblock %}
{% endblock %}

{% block create_user %}
    {% include 'partials/create_user.html' %}
{% endblock %}

{% block popup %}
    <div class="popap" id='addHomeGroup'>
        <div class="pop_cont">
            <div class="popup_text">
                <h2>Добавление домашней группы</h2>
                <span class="close close-popup"><i class="fa fa-times" aria-hidden="true"></i></span>
            </div>
            <form action="" id="addHomeGroup" name="addHomeGroup">
                <div class="popup_body">
                    <div class="container container_block">
                        <div class="column">
                            <div class="label_block-wrapp">
                                <span class="label_block">Дата открытия</span>
                            </div>
                            <div class="label_block-wrapp end__block">
                                <span class="label_block">Название</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Церковь</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Лидер</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Город</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Адрес служения</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Телефон</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Сайт</span>
                            </div>
                        </div>
                        <div>
                            <p><input id="added_home_group_date" required></p>
                            <p class="end__block"><input type="text" id="added_home_group_title"></p>
                            <p id="added_home_group_church" data-id="{{ church.id }}"
                               data-department="{{ church.department.id }}">{{ church.get_title }}</p>
                            <p><select id="added_home_group_pastor" required>
                                <option>Выберите пастора</option>
                            </select></p>
                            <p><input type="text" id="added_home_group_city" required></p>
                            <p><input type="text" id="added_home_group_address"></p>
                            <p><input type="tel" id="added_home_group_phone"></p>
                            <p><input type="url" id="added_home_group_site"></p>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <button class="close-popup">Отменить</button>
                    <button type="submit" class="add-church">Создать</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script src="{% static "libs/air-datepicker/dist/js/datepicker.min.js" %}"></script>
    <script src="{% static "libs/cropper/dist/cropper.min.js" %}"></script>
    <script src="{% static "js/add_user.js" %}"></script>
    <script src="{% static "js/churches_detail.js" %}"></script>
{% endblock %}
