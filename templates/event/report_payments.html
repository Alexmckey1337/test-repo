{% extends "layout_main.html" %}
{% load static %}
{% load payment_tags %}

{% block header.top.h1 %}<h1>Отчеты / Таблица платежей</h1>{% endblock %}

{% block header.buttons.top %}
    <div class="top-buttons-wrap">
        <ul class="top-buttons">
            <li></li>
        </ul>
    </div>
{% endblock %}
{% block header.buttons %}
    {% block header.tabs %}
        <div class="tabs">
            <ul class="nav tabs_link">
                <li><a href="{% url 'events:church_report_list' %}">Отчёты церквей</a></li>
                <li><a href="{% url 'events:church_report_statistics' %}">Статистика церквей</a></li>
                <li><a class="active" href="{% url 'events:report_payments' %}">Таблица платежей</a></li>
                <li><a href="{% url 'events:meeting_report_list' %}">Отчёты домашних групп</a></li>
                <li><a href="{% url 'events:meeting_report_statistics' %}">Статистика домашних групп</a></li>
            </ul>
        </div>
    {% endblock %}
    <div class="top-buttons-wrap">
        <ul class="top-buttons">
            {% block header.buttons.add %}
                <li>

                </li>
            {% endblock %}

            {% block header.buttons.export %}

            {% endblock %}
            {% block header.buttons.extra %}
            {% endblock %}
            {% block header.buttons.change_table %}
                <li>
                    <button id="filter_button" class="header__button" data-count="0">Фильтр</button>
                </li>
                <li>
                    <button id="sort-on"><i class="fa fa-cog" aria-hidden="true"></i></button>
                </li>
            {% endblock %}
        </ul>
    </div>
{% endblock %}

{% block main.content %}
    {% block pagination_top %}
        <div class="top-pag"></div>
        <div class="table__count"></div>
        <div class="pagination payments__pagination"><!--pagination -->
        </div><!--End pagination -->
    {% endblock %}

    {% block table %}
        <div class="table table-wrap clearfix" id="churchReportsPayments"><!--Table -->
            <div class="table scrollbar-inner" id="tableChurchReportsPayments"></div>
            <div class="query-none">
                <p></p>
            </div>
        </div><!--End Table -->
    {% endblock %}

    {% block pagination_bottom %}
        <div class="table__count"></div>
        <div class="pagination payments__pagination"></div>
    {% endblock %}
{% endblock %}

{% block popup %}
    {% update_payment_form %}
    <div class="popap" id='filterPopup'>
        <div class="pop_cont">
            <h2 class='popup_text'>Фильтр</h2>
            <div class="popup_body">
                <div class="container">
                    <label>
                        <span class="label_block">Валюта</span>
                        <select class="selectdb" data-filter="currency_sum" id="currency_sum">
                            <option value="">ВСЕ</option>
                            {% for currency in currencies %}
                                <option value="{{ currency.id }}">{{ currency.name }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <label>
                        <span class="label_block">Сумма платежа</span>
                        <p class="birthday">
                            <input type="number" placeholder="от" data-filter="sum_from" id="sum_from"
                                   class="select_from_filter">
                            <input type="number" placeholder="до" data-filter="sum_to" id="sum_to"
                                   class="select_to_filter">
                        </p>
                    </label>
                    <label>
                        <span class="label_block">Дата поступления платежа</span>
                        <p class="birthday">
                            <input type="text" placeholder="от" data-filter="sent_from" id="sent_date_from"
                                   class="date_filter select_from_filter">
                            <input type="text" placeholder="до" data-filter="sent_to" id="sent_date_to"
                                   class="date_filter select_to_filter">
                        </p>
                    </label>
                    <label>
                        <span class="label_block">Дата создания платежа</span>
                        <p class="birthday">
                            <input type="text" placeholder="от" data-filter="create_from" id="date_from"
                                   class="date_filter select_from_filter">
                            <input type="text" placeholder="до" data-filter="create_to" id="date_to"
                                   class="date_filter select_to_filter">
                        </p>
                    </label>
                    <label>
                        <span class="label_block">Дата создания отчета</span>
                        <p class="birthday">
                            <input type="text" placeholder="от" data-filter="report_date_from" id="purpose_date_from"
                                   class="date_filter select_from_filter">
                            <input type="text" placeholder="до" data-filter="report_date_to" id="purpose_date_to"
                                   class="date_filter select_to_filter">
                        </p>
                    </label>
                    <label>
                        <span class="label_block">Менеджер</span>
                        <select class="selectdb" data-filter="manager" id="manager">
                            <option value="">ВСЕ</option>
                            {% for manager in managers %}
                                <option value="{{ manager.id }}">{{ manager.fullname }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <label>
                        <span class="label_block">Пастор</span>
                        <select class="selectdb" data-filter="pastor_id" id="search_purpose_manager_fio">
                            <option value="">ВСЕ</option>
                            {% for pastor in pastors %}
                                <option value="{{ pastor.id }}">{{ pastor.fullname }}</option>
                            {% endfor %}
                        </select>
                    </label>
{#                    <label>#}
{#                        <span class="label_block">Поиск по описанию</span>#}
{#                        <input type="text" data-filter="search_description" placeholder="Описание или часть"#}
{#                               id="search_description">#}
{#                    </label>#}
                </div>
            </div>
            <div class="container">
                <button class="clear-filter"><i class="fa fa-refresh"
                                                aria-hidden="true"></i>
                    Очистить
                </button>
                <button class="close-popup">Отменить</button>
                <button class="apply-filter">Применить</button>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script src='{% static "libs/moment/min/moment-with-locales.min.js" %}'></script>
    <script src='{% static "libs/air-datepicker/dist/js/datepicker.min.js" %}'></script>
    <script src="{% static "js/report_payments.js" %}"></script>
{% endblock %}
{% block template_tables %}
<script type="text/template" id="databasePayments">
    <table id="table-1">
        <thead>
        <tr>
            <% for( var key in table_columns) { %>
            <% if(table_columns[key].active) { %>
            <th data-order="<%=table_columns[key].ordering_title%>"><%=table_columns[key].title %></th>
            <% } %>
            <% } %>
        </tr>
        </thead>
        <tbody>
        <% for( var index in results) { %>
        <tr>
            <% for( var key in table_columns) { %>
            <% if(table_columns[key].active) { %>
            <% if (key == 'church') { %>
            <% if (results[index].church_title != null) { %>
            <td class="edit"><a href="<%= '/churches/' + results[index].church_id  %>">
                <%= results[index].church_title %></a>
                {% if user.is_partner_supervisor_or_high %}
                    <span class="quick-edit" data-id="<%= results[index].id %>" data-name="<%= results[index].church_title %>">
                    </span>
                {% endif %}
            </td>
            <% } else { %>
            <td></td>
            <% } %>
            <% } else if(key == 'manager') { %>
            <% if (results[index][key] != null) { %>
            <td><a href="<%= '/account/' + results[index][key].id %>">
                <%= results[index][key].last_name + ' ' + results[index][key].first_name + ' ' + results[index][key].middle_name %></a>
            </td>
            <% } else { %>
            <td></td>
            <% } %>
            <% } else { %>
            <td><% if (results[index][key] === true ) { %>
                <p class="text__center">✔</p>
                <% } else if (results[index][key] === false){ %>

                <% } else { %>
                <%= results[index][key] %>
                <% } %>
            </td>
            <% } %>
            <% } %>
            <% } %>
        </tr>
        <% } %>
        </tbody>
    </table>
        <table id="header-fixed"></table>
</script>
{% endblock %}