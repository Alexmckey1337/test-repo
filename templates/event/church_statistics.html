{% extends "layout_main.html" %}
{% load static %}

{% block header.top.h1 %}<h1>Отчеты / Церкви</h1>{% endblock %}

{% block header.search %}{% endblock %}

{% block header.buttons.top %}
    <div class="top-buttons-wrap">
        <ul class="top-buttons">
            <li></li>
        </ul>
    </div>
{% endblock %}
{% block header.buttons %}
    {% block header.tabs %}
        <div class="tabs">
            <ul class="nav tabs_link">
                <li><a href="{% url 'events:church_report_list' %}">Отчёты церквей</a></li>
                <li><a class="active" href="{% url 'events:church_report_statistics' %}">Статистика церквей</a></li>
                <li><a href="{% url 'events:meeting_report_list' %}">Отчёты домашних групп</a></li>
                <li><a href="{% url 'events:meeting_report_statistics' %}">Статистика домашних групп</a></li>
            </ul>
        </div>
    {% endblock %}
    <div class="top-buttons-wrap">
        <ul class="top-buttons">
            {% block header.buttons.add %}
                <li>

                </li>
            {% endblock %}

            {% block header.buttons.export %}

            {% endblock %}
            {% block header.buttons.extra %}
            {% endblock %}
            {% block header.buttons.change_table %}
                <li>
                    <button id="filter_button"
                            data-count="0"
                    >
                        Фильтр
                    </button>
                </li>
            {% endblock %}
        </ul>
    </div>
{% endblock %}

{% block main.content %}
    <div class="container-full">
        <div class="tab-status tab-home-stats">
            <button class="week week_all">Все</button>
            <button class="week week_now active">Текущая неделя</button>
            <button class="week week_prev">Прошедшая неделя</button>
            <div class="set-date">
                <input type="text" placeholder="Диапазон дат" id="date_range" class="select_date_filter">
                <div class="cal-icon"></div>
            </div>
        </div>
        {% block pagination_top %}
            <div class="top-pag">
                <div id="period_expired" class="period">
                    <p>Период с <input type="text" id="expired_datepicker_from" readonly="readonly"> по <input
                            type="text" id="expired_datepicker_to" readonly="readonly"><a
                            id="show-all-expired" href="javascript:void(0);">Показать
                        все</a></p>
                </div>
                <div id="period_done" class="period">
                    <p>Период с <input type="text" id="done_datepicker_from" readonly="readonly"> по <input type="text"
                                                                                                            id="done_datepicker_to"readonly="readonly"><a
                            id="show-all-done" href="javascript:void(0);">Показать
                        все</a></p>
                </div>
            </div>
            {#        <div class="table__count"></div>#}
            {#        <div class="pagination users__pagination"><!--pagination -->#}
            {#        </div><!--End pagination -->#}
        {% endblock %}

        {% block table %}
            <div class="table-wrap clearfix" id="churchReports"><!--Table -->
                <div class="table scrollbar-inner" id="tableChurchReports"></div>
                <div class="query-none">
                    <p></p>
                </div>
            </div><!--End Table -->
        {% endblock %}

        {% block pagination_bottom %}
            <div id="statisticsContainer"></div>
        {% endblock %}
    </div>
{% endblock %}

{% block popup %}
    <div class="popap" id='filterPopup'>
        <div class="pop_cont">
            <h2 class='popup_text'>
                Фильтр
            </h2>
            <div class="popup_body">
                <div class="container">
                    <div class="col-6">
                        <div class="label_block-wrapp">
                            <span class="label_block">Отдел</span>
                        </div>
                        <div class="label_block-wrapp">
                            <span class="label_block">Ветка</span>
                        </div>
                        <div class="label_block-wrapp">
                            <span class="label_block">Пастор</span>
                        </div>
                        <div class="label_block-wrapp">
                            <span class="label_block">Церковь</span>
                        </div>
                    </div>
                    <div class="col-6">
                        <p class="input_block">
                            <select class="selectdb" data-filter="department" id="departments_filter">
                                <option value="">ВСЕ</option>
                                {% for department in departments %}
                                    <option value="{{ department.id }}">{{ department.title }}</option>
                                {% endfor %}
                            </select>
                        </p>
                        <p class="input_block">
                            <select class="selectdb" data-filter="master_tree" id="tree_filter">
                                <option value="">ВСЕ</option>
                            </select>
                        </p>
                        <p class="input_block">
                            <select class="selectdb" data-filter="pastor" id="pastor_filter">
                                <option value="">ВСЕ</option>
                            </select>
                        </p>
                        <p class="input_block">
                            <select class="selectdb" data-filter="church" id="church_filter">
                                <option value="">ВСЕ</option>
                            </select>
                        </p>
                    </div>
                </div>
            </div>
            <div class="container">
                <button onclick="refreshFilter(this)" class="clear-filter"><i class="fa fa-refresh"
                                                                              aria-hidden="true"></i>
                    Очистить
                </button>
                <button class="close-popup">Отменить</button>
                <button onclick="applyFilter(this, churchStatistics)" class="apply-filter">Применить</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
    <script src="{% static "js/church_statistics.js" %}"></script>
{% endblock %}
{% block template_tables %}
    <script type="text/template" id="statisticsTmp">
        <div class="panel panel-success">
            <div class="panel-body">
                <div class="row">
                    <div class="grid_block">
                        <div class="col-sm-4">
                            <div class="well info"><span>Всего людей на собрании</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="planned_sum_deals" class="label label-primary">
                                        <%= (total_peoples) ? total_peoples : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="well success"><span>Всего новых людей</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="paid_sum_deals" class="label label-primary">
                                        <%= (total_new_peoples) ? total_new_peoples : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="well success"><span>Всего покаяний</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="percent_paid_sum_deals" class="label label-primary">
                                        <%= (total_repentance) ? total_repentance : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="grid_block">
                        <div class="col-sm-4">
                            <div class="well success"><span>Заполненные отчёты</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="closed_planned_sum_deals" class="label label-primary">
                                        <%= (church_reports_submitted) ? church_reports_submitted : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="well info"><span>Отчёты к заполнению</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="closed_paid_sum_deals" class="label label-primary">
                                        <%= (church_reports_in_progress) ? church_reports_in_progress : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="well error"><span>Просроченные отчёты</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="closed_percent_paid_sum_deals" class="label label-primary">
                                        <%= (church_reports_expired) ? church_reports_expired : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="grid_block">
                        <div class="col-sm-4">
                            <div class="well info"><span>Десятины</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="closed_planned_sum_deals" class="label label-primary">
                                        <%= (total_tithe) ? total_tithe : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="well info"><span>Десятина пастора</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="closed_paid_sum_deals" class="label label-primary">
                                        <%= (total_pastor_tithe) ? total_pastor_tithe : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="well info"><span>15% к перечислению</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="closed_percent_paid_sum_deals" class="label label-primary">
                                        <%= (total_transfer_payments) ? total_transfer_payments : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="grid_block">
                        <div class="col-12">
                            <div class="well success"><span>Всего пожертвований</span>
                                <p style="font-size:4em;text-align: center">
                                    <span id="closed_percent_paid_sum_deals" class="label label-primary">
                                        <%= (total_donations) ? total_donations : 0 %>
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </script>
{% endblock %}