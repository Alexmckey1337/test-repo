{% extends "layout_database.html" %}
{% load static %}

{% block header.top.h1 %}<h1>База данных / Церкви</h1>{% endblock %}

{% block header.buttons.top %}
    <div class="top-buttons-wrap">
        <ul class="top-buttons">
            <li>
                <button id="add" class="header__button">Добавить церковь</button>
            </li>
            <li>
                <button id="filter_button" class="header__button">Фильтр</button>
            </li>
            <li>
                <button id="export_table" data-export-url="{% url "church-export" %}" class="download header__button">Export</button>
            </li>
            <li>
                <button id="sort-on"><i class="fa fa-cog" aria-hidden="true"></i></button>
            </li>
        </ul>
    </div>
{% endblock %}

{% block table %}
    <div class="table-wrap  clearfix" id="churches"><!--Table -->
        <div class="table scrollbar-inner" id="tableChurches"></div>
        <div class="query-none">
            <p></p>
        </div>
    </div><!--End Table -->
    <div class="preloader">
        <div class="gif"></div>
    </div>
{% endblock %}

{% block popup %}
    <div class="popap" id="quickEditCartPopup">
        <div class="pop_cont">
            <div class="popup_text">
                <h2>Карточка церкви</h2>
                <span class="close close-popup"><i class="fa fa-times" aria-hidden="true"></i></span>
            </div>
            <div class="popup_body">
            </div>
            <div class="container">
                <button class="close-popup change__text">Отменить</button>
                <button onclick="saveChurches(this)" class="save-user">Сохранить</button>
            </div>
        </div>
    </div>
    <div class="popap" id='filterPopup'>
        <div class="pop_cont">
            <h2 class='popup_text'>
                Фильтр
            </h2>
            <div class="popup_body">
                <div class="container">
                    <div class="col-6">
                        <div class="label_block-wrapp">
                            <span class="label_block">Отдел</span>
                        </div>
                        <div class="label_block-wrapp">
                            <span class="label_block">Ветка</span>
                        </div>
                        <div class="label_block-wrapp">
                            <span class="label_block">Пастор</span>
                        </div>
                        <div class="label_block-wrapp">
                            <span class="label_block">Открыта</span>
                        </div>
                        <div class="label_block-wrapp">
                            <span class="label_block">Дата открытия</span>
                        </div>
                        <div class="label_block-wrapp">
                            <span class="label_block">Фильтр по стране</span>
                        </div>
                        <div class="label_block-wrapp">
                            <span class="label_block">Фильтр по городу</span>
                        </div>
                    </div>
                    <div class="col-6">
                        <p class="input_block">
                            <select class="selectdb" data-filter="department" id="departments_filter">
                                <option value="">ВСЕ</option>
                                {% for department in departments %}
                                    <option value="{{ department.id }}">{{ department.title }}</option>
                                {% endfor %}
                            </select>
                        </p>
                    <p class="input_block">
                            <select class="selectdb" data-filter="master_tree" id="tree_filter">
                                <option value="">ВСЕ</option>
                                {% for master in masters %}
                                    <option value="{{ master.id }}">{{ master.fullname }}</option>
                                {% endfor %}
                            </select>
                        </p>
                        <p class="input_block">

                            <select class="selectdb" data-filter="pastor" id="pastor_filter">
                                <option value="">ВСЕ</option>
                                {% for pastor in church_all_pastors %}
                                    <option value="{{ pastor.id }}">{{ pastor.fullname }}</option>
                                {% endfor %}
                            </select>
                        </p>
                        <p class="input_block">
                            <select name="search_is_open" data-filter="is_open" id="search_is_open">
                                <option value="1">ВСЕ</option>
                                <option value="2">ДА</option>
                                <option value="3">НЕТ</option>
                            </select>
{#                            <input type="checkbox" data-filter="is_open" id="search_is_open">#}
                        </p>
                        <p class="input_block">
                            <input type="text" data-filter="opening_date" id="search_date_open">
                        </p>
                        <p class="input_block">
                            <input type="text" data-filter="country" placeholder="страна или часть названия"
                                   id="search_country">
                        </p>
                        <p class="input_block">
                            <input type="text" data-filter="city" placeholder="город или часть названия"
                                   id="search_city">
                        </p>
                    </div>
                </div>
            </div>
            <div class="container">
                <button onclick="refreshFilter(this)" class="clear-filter"><i class="fa fa-refresh"
                                                                                  aria-hidden="true"></i>
                    Очистить</button>
                <button class="close-popup">Отменить</button>
                <button onclick="applyFilter(this, createChurchesTable)" class="apply-filter">Применить</button>
            </div>
        </div>
    </div>
    <div class="popap" id='addChurch'>
        <div class="pop_cont">
            <div class="popup_text">
                <h3>Создание новой церкви</h3>
                <span class="close close-popup"><i class="fa fa-times" aria-hidden="true"></i></span>
            </div>

            <form action="" onsubmit="addChurch(event, this, createChurchesTable)">
                <div class="popup_body">
                    <div class="container container_block">
                        <div class="column">
                            <div class="label_block-wrapp">
                                <span class="label_block">Дата открытия</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Открыта</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Название</span>
                            </div>
                            <div class="label_block-wrapp end__block">
                                <span class="label_block">Выберите отдел</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Страна</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Город</span>
                            </div>
                            <div class="label_block-wrapp end__block">
                                <span class="label_block">Пастор</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Адрес служения</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Телефон</span>
                            </div>
                            <div class="label_block-wrapp">
                                <span class="label_block">Сайт</span>
                            </div>
                        </div>
                        <div>
                            <p><input type="text" id="added_churches_date" required></p>
                            <p><input type="checkbox" id="added_churches_is_open"></p>
                            <p><input type="text" id="added_churches_title"></p>
                            <p class="end__block"><select name="department" id="department_select">
                                {% for item in departments %}
                                    <option value="{{ item.id }}">{{ item.title }}</option>
                                {% endfor %}
                            </select></p>
                            <p><input type="text" id="added_churches_country" required></p>
                            <p><input type="text" id="added_churches_city" required></p>
                            <p class="end__block"><select name="pastor" id="pastor_select" disabled required>
                                <option value="0">Выберите пастора</option>
                            </select></p>
                            <p><input type="text" id="added_churches_address"></p>
                            <p><input type="tel" id="added_churches_phone"></p>
                            <p><input type="url" id="added_churches_site"></p>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <button class="close-popup">Отменить</button>
                    <button type="submit" class="add-church">Создать</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script src="{% static "js/database_churches.js" %}"></script>
    <script src="{% static "libs/cropper/dist/cropper.min.js" %}"></script>
    <script type="text/template" id="quickEditCart">
        <div class="container bb-1">
            <div class="header">
                <div><input type="text" class="title" id="church_title" value="<%=get_title %>"></div>
                <div class="row">
                    <div class="label_block-wrapp">
                        <label class="label_block" for="is_open">Открыта</label>
                    </div>
                    <input type="checkbox" id="is_open_church"<% if(is_open) { %>
                    checked <% } %> >
                </div>
                <% if(opening_date) { %>
                <div class="row">
                    <div class="label_block-wrapp">
                        <label class="label_block" for="opening_date">Дата открытия</label>
                    </div>
                    <input type="text" class="date" id="opening_date" value="<%= opening_date.split('.').reverse().join('-') %>">
                </div>
                <% } else { %>
                <div>
                    <div class="label_block-wrapp">
                        <label class="label_block" for="opening_date">Дата открытия</label>
                    </div>
                    <input type="text" id="opening_date" class="date" value="">
                </div>
                <% } %>
                <div class="hidden"><input type="text" id="churchID" value="<%= id %>"></div>
            </div>
        </div>
        <div class="container start">
            <div class="column">
                <div class="label_block-wrapp">
                    <span class="label_block">Отдел:</span>
                </div>
                <div class="label_block-wrapp">
                    <span class="label_block">Пастор:</span>
                </div>
                <div class="label_block-wrapp">
                    <span class="label_block">Страна</span>
                </div>
                <div class="label_block-wrapp">
                    <span class="label_block">Нас.пункт:</span>
                </div>
                <div class="label_block-wrapp">
                    <span class="label_block">Адрес:</span>
                </div>
                <div class="label_block-wrapp">
                    <span class="label_block">Телефон:</span>
                </div>
                <div class="label_block-wrapp">
                    <span class="label_block">Сайт:</span>
                </div>
            </div>
            <div>
                <div><select name="" id="editDepartmentSelect">
                    <option value="<%= department %>"><%= department %></option>
                </select></div>
                <div><select name="" id="editPastorSelect">
                    <option value="<%= pastor %>"><%= pastor %></option>
                </select></div>
                <p><input type="text" id="country" value="<%=country %>"></p>
                <p><input type="text" id="city" value="<%=city %>"></p>
                <p><input type="text" id="address" value="<%=address %>"></p>
                <p><input type="text" id="phone_number" value="<%=phone_number %>"></p>
                <p><input type="text" id="web_site" value="<%=website %>"></p>
            </div>
        </div>
    </script>
{% endblock %}